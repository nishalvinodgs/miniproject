<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Products - thriftIN</title>
	<style>
	/* Base Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    font-family: 'Arial', sans-serif;
    background-color: #000;
    color: #fff;
    overflow-x: hidden;
}

/* Header Styles (matching 2nd_street_india.html) */
.header {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    border-bottom: 1px solid rgba(255,255,255,0.08);
    z-index: 1000;
    padding: 15px 0;
    transition: all 0.3s ease;
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 20px;
}
/* Cart icon */
.cart-icon {
    position: relative;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 1px solid rgba(255,255,255,0.3);
    cursor: pointer;
}
.cart-count {
    position: absolute;
    top: -6px;
    right: -6px;
    background: #fff;
    color: #000;
    font-size: 12px;
    font-weight: 700;
    padding: 2px 6px;
    border-radius: 999px;
}

/* Cart drawer */
.cart-drawer {
    position: fixed;
    top: 0;
    right: -420px;
    width: 420px;
    height: 100vh;
    background: #0e0e0e;
    border-left: 1px solid rgba(255,255,255,0.15);
    box-shadow: -20px 0 40px rgba(0,0,0,0.5);
    transition: right .3s ease;
    z-index: 2100;
    display: flex;
    flex-direction: column;
}
.cart-drawer.open { right: 0; }
.cart-header { padding: 16px 18px; display:flex; justify-content: space-between; align-items:center; border-bottom: 1px solid rgba(255,255,255,0.12); }
.cart-items { flex: 1; overflow-y: auto; padding: 10px 18px; }
.cart-item { display:flex; gap:12px; padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.08); }
.cart-item img { width:70px; height:70px; object-fit: cover; border-radius:8px; }
.cart-item-title { font-weight:700; }
.qty { display:flex; gap:8px; align-items:center; }
.qty button { width:26px; height:26px; border-radius:6px; border:none; background:#222; color:#fff; cursor:pointer; transition: all 0.2s ease; }
.qty button:hover { background:#333; }
.qty button:disabled { opacity: 0.5; cursor: not-allowed; }
.cart-footer { border-top: 1px solid rgba(255,255,255,0.12); padding: 14px 18px; }
.summary-row { display:flex; justify-content: space-between; margin: 6px 0; }
.proceed-btn { width:100%; padding:12px 16px; border:none; border-radius:999px; background: linear-gradient(45deg, #fff, #ccc); color:#000; font-weight:800; cursor:pointer; margin-top:10px; }

@media (max-width: 480px) { .cart-drawer { width: 100%; } }

.logo-container {
    display: flex;
    align-items: center;
    gap: 0px;
}

.logo-img {
    height: 80px;
    width: auto;
}

.logo-text {
    font-size: 25px;
    font-weight: bold;
    color: #fff;
    text-decoration: none;
    animation: glow 2s ease-in-out infinite alternate;
}

@keyframes glow {
    from { text-shadow: 0 0 5px #fff, 0 0 10px #fff; }
    to { text-shadow: 0 0 10px #fff, 0 0 20px #fff; }
}

.nav-menu {
    display: flex;
    list-style: none;
    gap: 30px;
}

.nav-menu a {
    color: #fff;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
    position: relative;
}

.nav-menu a:hover {
    color: #ccc;
    transform: translateY(-2px);
}

.nav-menu a::after {
    content: '';
    position: absolute;
    width: 0;
    height: 2px;
    bottom: -5px;
    left: 0;
    background: #fff;
    transition: width 0.3s ease;
}

.nav-menu a:hover::after {
    width: 100%;
}

/* Main Content */
.products-main {
    display: flex;
    max-width: 1200px;
    margin: 100px auto 50px;
    padding: 0 20px;
}

/* Filters Sidebar */
.filters-sidebar {
    width: 250px;
    padding: 20px;
    background: rgba(17, 17, 17, 0.95);
    border-radius: 10px;
    margin-right: 30px;
    height: fit-content;
    position: sticky;
    top: 100px;
}

.filter-section {
    margin-bottom: 25px;
}

.filter-section h3 {
    font-size: 1.2rem;
    margin-bottom: 15px;
    color: #fff;
    border-bottom: 1px solid #333;
    padding-bottom: 8px;
}

.filter-list {
    list-style: none;
}

.filter-list li {
    margin-bottom: 10px;
}

.filter-list a {
    color: #ccc;
    text-decoration: none;
    transition: color 0.3s ease;
    display: block;
    padding: 5px 0;
}

.filter-list a:hover, .filter-list a.active {
    color: #fff;
}

.price-range {
    margin-top: 15px;
}

.price-slider {
    width: 100%;
    margin-bottom: 10px;
    -webkit-appearance: none;
    height: 5px;
    background: #333;
    outline: none;
    opacity: 0.7;
    transition: opacity .2s;
}

.price-slider:hover {
    opacity: 1;
}

.price-slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 15px;
    height: 15px;
    border-radius: 50%;
    background: #fff;
    cursor: pointer;
}

.price-values {
    display: flex;
    justify-content: space-between;
    font-size: 0.9rem;
    color: #ccc;
}

.condition-filters {
    display: flex;
    flex-direction: column;
    gap: 10px;
}

.condition-filters label {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.9rem;
    color: #ccc;
    cursor: pointer;
}

.condition-filters input {
    accent-color: #fff;
}

.apply-filters {
    width: 100%;
    padding: 12px;
    background: linear-gradient(45deg, #fff, #ccc);
    color: #000;
    border: none;
    border-radius: 5px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    margin-top: 10px;
}

.apply-filters:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(255, 255, 255, 0.2);
}

/* Products Grid */
.products-grid {
    flex: 1;
}

.products-header {
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: flex-end;
    margin-bottom: 30px;
    gap: 10px;
}

/* Search Bar */
.products-search {
    position: relative;
    margin-bottom: 20px;
}
.search-input {
    width: 100%;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: #fff;
    padding: 12px 16px;
    border-radius: 8px;
    outline: none;
    font-size: 1rem;
}
.search-input::placeholder { color: #aaa; }
.suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: #0e0e0e;
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.5);
    z-index: 1500;
    display: none;
}
.suggestions.open { display: block; }
.suggestion-item {
    display: flex;
    gap: 12px;
    padding: 12px 15px;
    align-items: center;
    cursor: pointer;
    transition: background .2s ease;
}
.suggestion-item:hover { background: rgba(255,255,255,0.06); }
.suggestion-thumb { width: 45px; height: 45px; object-fit: cover; border-radius: 6px; }
.suggestion-title { color: #fff; font-size: 1rem; font-weight: 600; }
.suggestion-price { color: #bbb; font-size: 0.9rem; }

.products-header h2 {
    font-size: 2.2rem;
    font-weight: 700;
    color: #fff;
    margin-bottom: 10px;
    line-height: 1.4;
    text-shadow: 0 0 5px rgba(255, 255, 255, 0.2);
    flex: 1;
}

.sort-options select {
    padding: 8px 15px;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 5px;
    color: #fff;
    cursor: pointer;
}

.products-container {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 25px;
    margin-bottom: 30px;
}

.product-card {
    background: #111;
    border-radius: 10px;
    overflow: hidden;
    transition: all 0.3s ease;
    position: relative;
}

.product-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 20px rgba(255, 255, 255, 0.1);
}

.product-image {
    width: 100%;
    height: 200px;
    position: relative;
    overflow: hidden;
}

.product-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.5s ease;
}

.product-card:hover .product-image img {
    transform: scale(1.05);
}

.product-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.7);
    color: #fff;
    padding: 5px 10px;
    border-radius: 5px;
    font-size: 0.8rem;
}

.product-info {
    padding: 15px;
}

.product-title {
    font-size: 1rem;
    margin-bottom: 8px;
    color: #fff;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}

.product-price {
    font-size: 1.2rem;
    font-weight: bold;
    color: #fff;
    margin-bottom: 10px;
}

.product-original-price {
    text-decoration: line-through;
    color: #ccc;
    font-size: 0.9rem;
    margin-left: 5px;
}

.product-condition {
    font-size: 0.8rem;
    color: #ccc;
    margin-bottom: 10px;
}

.add-to-cart {
    width: 100%;
    padding: 8px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #fff;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.add-to-cart:hover {
    background: rgba(255, 255, 255, 0.2);
}

/* Pagination */
.pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 20px;
    margin-top: 30px;
}

.pagination button {
    padding: 8px 15px;
    background: rgba(255, 255, 255, 0.1);
    border: 1px solid rgba(255, 255, 255, 0.3);
    color: #fff;
    border-radius: 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.pagination button:hover:not(:disabled) {
    background: rgba(255, 255, 255, 0.2);
}

.pagination button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

.page-info {
    font-size: 0.9rem;
    color: #ccc;
}

/* Loading Spinner */
.loading-spinner {
    width: 50px;
    height: 50px;
    border: 5px solid rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    border-top-color: #fff;
    animation: spin 1s ease-in-out infinite;
    margin: 50px auto;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Footer Styles (matching homepage) */
.footer {
    background: #111;
    padding: 50px 0;
    text-align: center;
    border-top: 1px solid #333;
}

.container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 20px;
}

.footer-content {
    display: flex;
    justify-content: space-around;
    flex-wrap: wrap;
    margin-bottom: 30px;
}

.footer-section h3 {
    color: #fff;
    margin-bottom: 15px;
}

.footer-section a {
    color: #ccc;
    text-decoration: none;
    display: block;
    margin-bottom: 8px;
    transition: color 0.3s ease;
}

.footer-section a:hover {
    color: #fff;
}

/* Responsive Design */
@media (max-width: 768px) {
    .products-main {
        flex-direction: column;
        margin-top: 80px;
    }
    
    .filters-sidebar {
        width: 100%;
        position: static;
        margin-right: 0;
        margin-bottom: 30px;
    }
    
    .products-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .products-container {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
        gap: 15px;
    }
    
    .product-image {
        height: 150px;
    }
    
    .nav-menu {
        display: none;
    }
}
</style>
</head>
<body>
    <div id="navbarMount"></div>
    <script>
    (function(){
        fetch('navbar.html').then(function(r){ return r.text(); }).then(function(html){
            var m = document.getElementById('navbarMount');
            if (m) m.innerHTML = html;
            // After navbar loads, attach cart icon inside <nav> for perfect alignment
            var navEl = document.querySelector('.nav-container nav');
            if (navEl && !document.getElementById('cartButton')) {
                var cart = document.createElement('div');
                cart.id = 'cartButton';
                cart.className = 'cart-icon';
                cart.title = 'My Cart';
                cart.innerHTML = '🛒<span id="cartCount" class="cart-count">0</span>';
                navEl.appendChild(cart);

                // ATTACH LISTENERS HERE to avoid race condition
                document.getElementById('cartButton').addEventListener('click', () => {
                    document.getElementById('cartDrawer').classList.add('open');
                    window.cartManager.renderCart();
                });
                document.getElementById('closeCart').addEventListener('click', () => {
                    document.getElementById('cartDrawer').classList.remove('open');
                });
                document.getElementById('proceedToBuy').addEventListener('click', () => {
                    window.location.href = 'checkout.html';
                });
            }
        }).catch(function(){});
    })();
    </script>

    <!-- Main Content -->
    <main class="products-main">
        <!-- Sidebar Filters -->
        <aside class="filters-sidebar">
            <div class="filter-section">
                <h3>Categories</h3>
                <ul class="filter-list">
                    <li><a href="products_page.html" data-category="all">All Products</a></li>
                    <li><a href="products_page.html?category=watches" data-category="watches">Branded Watches</a></li>
                    <li><a href="products_page.html?category=shoes" data-category="shoes">Branded Shoes</a></li>
                    <li><a href="products_page.html?category=bags" data-category="bags">Luxury Bags</a></li>
                    <li><a href="products_page.html?category=gaming" data-category="gaming">Gaming</a></li>
                    <li><a href="products_page.html?category=gadgets" data-category="gadgets">Gadgets</a></li>
                </ul>
            </div>
            
            <div class="filter-section">
                <h3>Price Range</h3>
                <div class="price-range">
                    <input type="range" min="0" max="300000" value="300000" class="price-slider" id="priceRange">
                    <div class="price-values">
                        <span>₹0</span>
                        <span>₹3,00,000</span>
                    </div>
                </div>
            </div>
            
            <div class="filter-section">
                <h3>Condition</h3>
                <div class="condition-filters">
                    <label><input type="checkbox" name="condition" value="new" checked> New</label>
                    <label><input type="checkbox" name="condition" value="like-new" checked> Like New</label>
                    <label><input type="checkbox" name="condition" value="good" checked> Good</label>
                    <label><input type="checkbox" name="condition" value="fair" checked> Fair</label>
                </div>
            </div>
            
            <button class="apply-filters">Apply Filters</button>
        </aside>

        <!-- Products Grid -->
        <section class="products-grid">
            <!-- Search Bar -->
            <div class="products-search">
                <input id="searchInput" class="search-input" type="text" placeholder="Search brands or products (e.g., Rolex, Gucci)" autocomplete="off">
                <div id="suggestions" class="suggestions"></div>
            </div>
            <div class="products-header">
                <h2 id="productsTitle">Premium Pre-owned Products</h2>
                <div class="sort-options">
                    <select id="sortBy">
                        <option value="popular">Popular</option>
                        <option value="newest">Newest</option>
                        <option value="price-low">Price: Low to High</option>
                        <option value="price-high">Price: High to Low</option>
                    </select>
                </div>
            </div>
            
            <div class="products-container" id="productsContainer">
                <!-- Products will be loaded here via JavaScript -->
                <div class="loading-spinner"></div>
            </div>
            
            <div class="pagination">
                <button class="prev-page" disabled>Previous</button>
                <span class="page-info">Page 1 of 5</span>
                <button class="next-page">Next</button>
            </div>
        </section>
    </main>

    <!-- Footer (matching homepage) -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <a href="2nd_street_india.html">Home</a>
                    <a href="products_page.html">Products</a>
                    <a href="about_page.html">About Us</a>
                    <a href="contact_page.html">Contact</a>
                </div>

                <div class="footer-section">
                    <h3>Categories</h3>
                    <a href="products_page.html?category=women">Women's Fashion</a>
                    <a href="products_page.html?category=men">Men's Fashion</a>
                    <a href="products_page.html?category=bags">Luxury Bags</a>
                    <a href="products_page.html?category=watches">Watches</a>
                </div>

                <div class="footer-section">
                    <h3>Support</h3>
                    <a href="#">Help Center</a>
                    <a href="#">Shipping Info</a>
                    <a href="#">Returns</a>
                    <a href="#">Size Guide</a>
                </div>
                <div class="footer-section">
                    <h3>Connect</h3>
                    <a href="#">Instagram</a>
                    <a href="#">Facebook</a>
                    <a href="#">Twitter</a>
                    <a href="#">WhatsApp</a>
                </div>
            </div>
            <p>&copy; 2025 thriftIN. All rights reserved.</p>
        </div>
    </footer>

    <!-- Cart Drawer -->
    <aside id="cartDrawer" class="cart-drawer" aria-hidden="true">
        <div class="cart-header">
            <strong>My Cart</strong>
            <button id="closeCart" style="background:transparent;border:0;color:#fff;font-size:20px;cursor:pointer">✕</button>
        </div>
        <div id="cartItems" class="cart-items"></div>
        <div class="cart-footer">
            <div class="summary-row"><span>Items</span><strong id="cartItemsCount">0</strong></div>
            <div class="summary-row"><span>Subtotal</span><strong id="cartSubtotal">₹0</strong></div>
            <button id="proceedToBuy" class="proceed-btn">Proceed to Buy</button>
        </div>
    </aside>

<script>
// Global cart management functions - make them accessible from anywhere
window.cartManager = {
    getCart: function() {
        return JSON.parse(localStorage.getItem('cart_items') || '[]');
    },
    
    saveCart: function(cart) {
        localStorage.setItem('cart_items', JSON.stringify(cart));
    },
    
    addToCart: function(product) {
        const cart = this.getCart();
        const existing = cart.find(i => i.id == product.id);
        if (existing) { 
            existing.quantity += 1; 
        } else { 
            cart.push(product); 
        }
        this.saveCart(cart);
        this.renderCart();
        
        // Update cart count in header
        updateCartCount();
        
        // Show success message
        showCartMessage('Item added to cart!');
    },
    
    increaseQuantity: function(idx) {
        const cart = this.getCart();
        if (cart[idx]) {
            cart[idx].quantity += 1;
            this.saveCart(cart);
            this.renderCart();
            updateCartCount();
        }
    },
    
    decreaseQuantity: function(idx) {
        const cart = this.getCart();
        if (cart[idx] && cart[idx].quantity > 1) {
            cart[idx].quantity -= 1;
            this.saveCart(cart);
            this.renderCart();
            updateCartCount();
        }
    },
    
    removeItem: function(idx) {
        if (confirm('Remove this item from your cart?')) {
            const cart = this.getCart();
            cart.splice(idx, 1);
            this.saveCart(cart);
            this.renderCart();
            updateCartCount();
        }
    },
    
    renderCart: function() {
        const cart = this.getCart();
        const cartItemsEl = document.getElementById('cartItems');
        const count = cart.reduce((sum, i) => sum + i.quantity, 0);
        const subtotal = cart.reduce((sum, i) => sum + (i.price * i.quantity), 0);
        
        // Debug logging
        console.log('Cart items:', cart);
        console.log('Calculated subtotal:', subtotal);
        
        // Update cart count and subtotal
        document.getElementById('cartCount').textContent = count;
        document.getElementById('cartItemsCount').textContent = count;
        document.getElementById('cartSubtotal').textContent = `₹${subtotal.toLocaleString()}`;

        if (cart.length === 0) {
            cartItemsEl.innerHTML = '<p style="text-align:center;color:#888;padding:20px;">Your cart is empty.</p>';
            return;
        }

        cartItemsEl.innerHTML = cart.map((item, idx) => `
            <div class="cart-item" data-idx="${idx}">
                <img src="${item.image}" alt="${item.title}">
                <div style="flex:1">
                    <div class="cart-item-title">${item.title}</div>
                    <div style="color:#888;font-size:0.9rem;">₹${Number(item.price).toLocaleString()}</div>
                    <div class="qty">
                        <button onclick="window.cartManager.decreaseQuantity(${idx})" ${item.quantity <= 1 ? 'disabled' : ''}>-</button>
                        <span>${item.quantity}</span>
                        <button onclick="window.cartManager.increaseQuantity(${idx})">+</button>
                        <button onclick="window.cartManager.removeItem(${idx})" style="margin-left:auto;background:#cc0000;color:#fff;">🗑️</button>
                    </div>
                </div>
            </div>
        `).join('');
    }
};

document.addEventListener('DOMContentLoaded', function() {
    // Current page and filters state
    let currentPage = 1;
    let totalPages = 1;
    let currentFilters = {
        category: 'all',
        brand: '',
        maxPrice: 300000,
        conditions: ['new', 'like-new', 'good', 'fair'],
        sortBy: 'popular'
    };

    // DOM Elements
    const productsContainer = document.getElementById('productsContainer');
    const priceRangeSlider = document.getElementById('priceRange');
    const sortBySelect = document.getElementById('sortBy');
    const prevPageBtn = document.querySelector('.prev-page');
    const nextPageBtn = document.querySelector('.next-page');
    const pageInfo = document.querySelector('.page-info');
    const applyFiltersBtn = document.querySelector('.apply-filters');

    // Initialize the page
    initFilters();
    loadProducts();
    updateCartCount(); // Initialize cart count
    setupSearch();
    
    // Cart controls are now attached after navbar load.
    
    // Initial cart render
    window.cartManager.renderCart();

    // Event Listeners
    priceRangeSlider.addEventListener('input', updatePriceDisplay);
    sortBySelect.addEventListener('change', handleSortChange);
    prevPageBtn.addEventListener('click', goToPrevPage);
    nextPageBtn.addEventListener('click', goToNextPage);
    applyFiltersBtn.addEventListener('click', applyFilters);

    // Category filter links
    document.querySelectorAll('[data-category]').forEach(link => {
        link.addEventListener('click', function(e) {
            e.preventDefault();
            setActiveCategory(this.dataset.category);
        });
    });

    // Condition checkboxes
    document.querySelectorAll('input[name="condition"]').forEach(checkbox => {
        checkbox.addEventListener('change', function() {
            updateConditionsFilter(this.value, this.checked);
        });
    });

    function initFilters() {
        // Check for category and brand in URL parameters
        const urlParams = new URLSearchParams(window.location.search);
        const urlCategory = urlParams.get('category');
        const urlBrand = urlParams.get('brand');
        
        // Set active category from URL or default to 'all'
        const initialCategory = urlCategory || 'all';
        setActiveCategory(initialCategory);
        
        // Set brand filter if present
        if (urlBrand) {
            currentFilters.brand = urlBrand;
        }
        
        // Set price range display
        updatePriceDisplay();
        
        // Update products title
        updateProductsTitle();
    }

    function setActiveCategory(category) {
        currentFilters.category = category;
        
        // Update URL without reloading the page
        const url = new URL(window.location);
        if (category === 'all') {
            url.searchParams.delete('category');
        } else {
            url.searchParams.set('category', category);
        }
        
        // Preserve brand parameter if it exists
        const urlBrand = url.searchParams.get('brand');
        if (urlBrand) {
            currentFilters.brand = urlBrand;
        }
        
        window.history.pushState({}, '', url);
        
        // Update UI
        document.querySelectorAll('[data-category]').forEach(link => {
            if (link.dataset.category === category) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
        
        // Reload products
        currentPage = 1;
        loadProducts();
    }

    // Update price display
    function updatePriceDisplay() {
        const priceValue = priceRangeSlider.value;
        document.querySelector('.price-values span:last-child').textContent = `₹${Number(priceValue).toLocaleString()}`;
    }

    // Update conditions filter
    function updateConditionsFilter(condition, isChecked) {
        if (isChecked) {
            if (!currentFilters.conditions.includes(condition)) {
                currentFilters.conditions.push(condition);
            }
        } else {
            currentFilters.conditions = currentFilters.conditions.filter(c => c !== condition);
        }
    }

    // Handle sort change
    function handleSortChange() {
        currentFilters.sortBy = sortBySelect.value;
        currentPage = 1;
        loadProducts();
    }

    // Apply filters
    function applyFilters() {
        currentFilters.maxPrice = priceRangeSlider.value;
        currentPage = 1;
        loadProducts();
    }

    // Pagination functions
    function goToPrevPage() {
        if (currentPage > 1) {
            currentPage--;
            loadProducts();
        }
    }

    function goToNextPage() {
        if (currentPage < totalPages) {
            currentPage++;
            loadProducts();
        }
    }

    // Update pagination UI
    function updatePaginationUI() {
        prevPageBtn.disabled = currentPage === 1;
        nextPageBtn.disabled = currentPage === totalPages;
        pageInfo.textContent = `Page ${currentPage} of ${totalPages}`;
    }

    // Update products title based on current filters
    function updateProductsTitle() {
        const titleElement = document.getElementById('productsTitle');
        let title = 'Premium Pre-owned Products';
        
        if (currentFilters.category !== 'all') {
            const categoryNames = {
                'watches': 'Branded Watches',
                'shoes': 'Branded Shoes', 
                'bags': 'Luxury Bags',
                'gaming': 'Gaming',
                'gadgets': 'Gadgets'
            };
            title = categoryNames[currentFilters.category] || currentFilters.category;
            
            if (currentFilters.brand) {
                title += ` - ${currentFilters.brand}`;
            }
        }
        
        titleElement.textContent = title;
    }

    // Load products from server
    function loadProducts() {
        // Show loading spinner
        productsContainer.innerHTML = '<div class="loading-spinner"></div>';
        
        // Prepare filters for API
        const filters = {
            ...currentFilters,
            page: currentPage
        };
        
        // For demo purposes, using mock data since we don't have backend
        fetchProducts(filters).then(data => {
            displayProducts(data.products);
            totalPages = data.totalPages;
            updatePaginationUI();
            updateProductsTitle();
        });
    }

    // ====== Search with autocomplete ======
    function setupSearch(){
        const input = document.getElementById('searchInput');
        const box = document.getElementById('suggestions');
        if (!input || !box) return;

        let controller;
        const debounce = (fn, delay=250) => {
            let t; return (...args)=>{ clearTimeout(t); t=setTimeout(()=>fn(...args), delay); };
        };

        const render = (items)=>{
            if (!items || !items.length){ box.classList.remove('open'); box.innerHTML=''; return; }
            box.innerHTML = items.map(item => `
                <div class="suggestion-item" data-id="${item.id}" data-title="${item.title}" data-brand="${(item.brand||'').toLowerCase()}" data-category="${(item.category||'').toLowerCase()}">
                    <img class="suggestion-thumb" src="${item.image || item.image_url || item.image_path || 'guccibag.jpg'}" alt="${item.title}">
                    <div>
                        <div class="suggestion-title">${item.title}</div>
                        <div class="suggestion-price">${item.price ? '₹'+Number(item.price).toLocaleString() : ''}</div>
                    </div>
                </div>
            `).join('');
            box.classList.add('open');
            box.querySelectorAll('.suggestion-item').forEach(el=>{
                el.addEventListener('click', ()=>{
                    const title = el.dataset.title;
                    // If the clicked item exists in current list after load, scroll to it; else filter by brand keyword
                    input.value = title;
                    box.classList.remove('open');
                    box.innerHTML='';
                    // Filter by keyword via backend using existing flow
                    currentFilters.brand = el.dataset.brand || '';
                    currentPage = 1; loadProducts();
                    // After load, attempt to scroll to the product card if exists
                    setTimeout(()=>{
                        const card = document.querySelector('.product-card[data-id="'+el.dataset.id+'"]');
                        if (card) card.scrollIntoView({ behavior:'smooth', block:'center' });
                    }, 500);
                });
            });
        };

        const fetchSuggestions = debounce(async (q)=>{
            if (controller) controller.abort();
            controller = new AbortController();
            try {
                const res = await fetch('get_products.php', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        category: 'all',
                        brand: q.toLowerCase(),
                        page: 1,
                        sortBy: 'popular',
                        maxPrice: currentFilters.maxPrice,
                        conditions: currentFilters.conditions
                    }),
                    signal: controller.signal
                });
                const data = await res.json();
                const products = (data && data.products) ? data.products.slice(0,8) : [];
                render(products);
            } catch(e){ /* aborted or network error */ }
        }, 300);

        input.addEventListener('input', ()=>{
            const q = input.value.trim();
            if (q.length < 2){ box.classList.remove('open'); box.innerHTML=''; return; }
            fetchSuggestions(q);
        });
        input.addEventListener('focus', ()=>{ if (box.innerHTML) box.classList.add('open'); });
        document.addEventListener('click', (e)=>{ if (!box.contains(e.target) && e.target!==input) { box.classList.remove('open'); } });
    }

    // Display products in the grid
    function displayProducts(products) {
        if (products.length === 0) {
            productsContainer.innerHTML = '<p class="no-products" style="text-align:center;color:#888;padding:40px;">No products found matching your filters.</p>';
            return;
        }
        
        let html = '';
        
        products.forEach(product => {
            // Handle different possible image field names from database
            const imgSrc = product.image || product.image_url || product.image_path || 'guccibag.jpg';
            const condition = product.condi || product.condition || 'Good';
            const original = product.original_price ? Number(product.original_price) : null;
            const price = Number(product.price || 0);
            const sellerId = product.seller_id || product.sellerId || null;
            
            html += `
                <div class="product-card" data-id="${product.id}" data-seller-id="${sellerId}">
                    <div class="product-image">
                        <img src="${imgSrc}" alt="${product.title}">
                        ${condition ? `<span class="product-badge">${condition}</span>` : ''}
                    </div>
                    <div class="product-info">
                        <h3 class="product-title">${product.title}</h3>
                        <div class="product-price">
                            ₹${price.toLocaleString()}
                            ${original ? `<span class="product-original-price">₹${original.toLocaleString()}</span>` : ''}
                        </div>
                        ${condition ? `<p class="product-condition">Condition: ${condition}</p>` : ''}
                        <button class="add-to-cart">Add to Cart</button>
                    </div>
                </div>
            `;
        });
        
        productsContainer.innerHTML = html;
        
        // Add event listeners to "Add to Cart" buttons
        document.querySelectorAll('.add-to-cart').forEach(button => {
            button.addEventListener('click', function() {
                const card = this.closest('.product-card');
                const conditionText = card.querySelector('.product-condition');
                const product = {
                    id: card.dataset.id,
                    title: card.querySelector('.product-title').textContent,
                    price: parseFloat(card.querySelector('.product-price').textContent.replace(/[₹,]/g, '')),
                    image: card.querySelector('img').getAttribute('src'),
                    quantity: 1,
                    condition: conditionText ? conditionText.textContent.replace('Condition: ', '') : 'Good',
                    seller_id: card.dataset.sellerId
                };
                
                // Debug logging
                console.log('Adding product to cart:', product);
                console.log('Price extracted:', product.price);
                
                window.cartManager.addToCart(product);
            });
        });
    }

    // Update cart count in header
    function updateCartCount() {
        const cartCount = document.querySelector('.cart-count');
        if (cartCount) {
            const items = JSON.parse(localStorage.getItem('cart_items') || '[]');
            const totalItems = items.reduce((sum, item) => sum + item.quantity, 0);
            cartCount.textContent = totalItems;
            cartCount.style.display = totalItems > 0 ? 'block' : 'none';
        }
        // Also update the cart display
        window.cartManager.renderCart();
    }

    // Show cart message
    function showCartMessage(message) {
        const messageDiv = document.createElement('div');
        messageDiv.textContent = message;
        messageDiv.style.cssText = `
            position: fixed;
            top: 100px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            z-index: 2000;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        document.body.appendChild(messageDiv);
        
        setTimeout(() => {
            messageDiv.remove();
        }, 3000);
    }

    // Real API call to fetch products from database
    function fetchProducts(filters) {
        return fetch('get_products.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(filters)
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            return response.json();
        })
        .catch(error => {
            console.error('Error fetching products:', error);
            // Return empty result on error
            return {
                products: [],
                totalPages: 0,
                totalCount: 0,
                currentPage: filters.page || 1
            };
        });
    }
});
</script>
</body>
</html>